# 크롤링과 엑셀 업무 자동화

> **원본 포스트 ID**: 195
> **발행일**: 2025-06-18 23:55:03
> **카테고리**: project/웹개발

## 📝 원문 내용

크롤링이란??

* * *

크롤링(Crawling)은 웹 페이지를 자동으로 탐색하고 데이터를 수집하는 기술입니다. 보통 "웹 크롤러" 또는 "봇(Bot)"이라는 프로그램이 사용되며, 사람들이 브라우저로 웹사이트를 하나하나 열어보지 않아도 **웹의 정보를 자동으로 수집** 할 수 있게 해줍니다.

이번에는 이걸 node.js로 구현해볼껍니다.크롤링에 쓸 도구로는 cheerio가 있습니다.

<https://www.npmjs.com/package/cheerio>

[ cheerio The fast, flexible & elegant library for parsing and manipulating HTML and XML.. Latest version: 1.1.0, last published: 10 days ago. Start using cheerio in your project by running `npm i cheerio`. There are 17960 other projects in the npm registry using ch www.npmjs.com ](https://www.npmjs.com/package/cheerio)

**만들어보기**

* * *

mainRouter.js 수정하기

필요한 도구를 const 합니다.

const cheerio = require('cheerio')

const axios = require('axios')

const iconv = require('iconv-lite')

axios는 외부사이트 에서 그림파일을 가져올때 쓰는 도구입니다.

iconv는 한국어를 지원해주는 도구입니다.

터미널에서 설치를 해줍니다

![](./img/195_img.png)

이제 크롤링할 사이트를 찾아줍시다

<https://finance.naver.com/>

[ 네이버페이 증권 국내 해외 증시 지수, 시장지표, 뉴스, 증권사 리서치 등 제공 finance.naver.com ](https://finance.naver.com/)

크롤링할 타겟을 찾아줍니다

![](./img/195_img_1.png)

일단 쉬운거부터 최근조회종목 박스를 가져와보겠습니다.

가져오기위해서 html코드를 알아야합니다 개발자도구를 열어서 알아봅시다.

![](./img/195_img_2.png)

이제 router를 하나 만듭니다.

router.get("/crawling", function(req,res){

res.send({success:200})

})

![](./img/195_img_3.png)

이제 가져와 봅시다.

router.get("/crawling", function(req,res){

  


aioxs({url:url})

res.send({success:200})

})

url이라는 변수도 선언해줍니다.

const url = "<https://finance.naver.com/sise/>"

어떤 방식인지 선언해주고 한글이 깨지지 않게 arraybuffer도 써줍니다.

axios({url:url, method:"GET", responseType:"arraybuffer"}).then(function(html)

이제 도구들을 사용해주고 가져오고싶은 태그를 적습니다.

router.get("/crawling", function(req,res){

axios({url:url, method:"GET", responseType:"arraybuffer"}).then(function(html){

const content = iconv.decode(html.data, "EUC-KR").toString()

const $ = cheerio.load(content)

const h3 = $(".top_tlt")

console.log(h3.text())

res.send({success:200})

})

})

응답 데이터를 EUC-KR에서 UTF-8로 디코딩하여 문자열로 변환하고

HTML 내용을 파싱해서 jQuery처럼 사용할 수 있도록 설정 후 .box_rolling 클래스를 가진 요소를 선택(내가가져오고싶은 class)

해당 요소의 텍스트를 콘솔에 출력 클라이언트에 성공 응답 전송 ({ success: 200 })

클라이언트에서 확인해봅시다.

![](./img/195_img_4.png)

성공했으니까 콘솔에서 확인해보면

![](./img/195_img_5.png)

이런식으로 업종별시세 더보기 테마별시세.. 이런식으로 가져온걸 볼 수 있다.

**네이버 증권 화면에서 주식 정보 가져오기**

* * *

가져오고싶은건 증시정보입니다.

![](./img/195_img_6.png)

이런식으로 개발자도구로 확인해보면 table안에 tbody 안에 tr 그안에 td의 형식으로 전형적인 테이블 구조임을 확인할 수 있습니다.

이번에는 table 자체를 통체로 가져와봅시다.

router.get("/crawling", function(req,res){

axios({url:url, method:"GET", responseType:"arraybuffer"}).then(function(html){

const content = iconv.decode(html.data, "EUC-KR").toString()

const $ = cheerio.load(content)

const table = $(".type_1 tr td")

  


res.send({success:200})

})

})

정보는 td안에 있어서 저런식으로 td까지 적어줍니다.

router.get("/crawling", function(req,res){

axios({url:url, method:"GET", responseType:"arraybuffer"}).then(function(html){

const content = iconv.decode(html.data, "EUC-KR").toString()

const $ = cheerio.load(content)

const table = $(".type_5 tr td")

table.each(function(i, tag){

console.log(i)

})

res.send({success:200})

})

})

각 셀을 순회하며 텍스트만 추출 후 출력하게합니다

한번 확인해봅시다.

![](./img/195_img_7.png)

가져오는걸 확인했으니까 td 요소안의 텍스트를 추출해봅시다.

table.each(function(i, tag){

console.log($(tag).text().trim)

})

터미널에서 확인해봅시다.

![](./img/195_img_8.png)

에??  
아 괄호를 빼먹었군요 괄호 추가해줍니다.

table.each(function(i, tag){

console.log($(tag).text().trim())

})

잘 작동합니다.

![](./img/195_img_9.png)

**엑셀 파일을 JSON 데이터로 바꾸기**

* * *

일단 엑셀파일을 하나 만듭니다.

![](./img/195_img_10.png)

라우터 하나 만듭니다.

router.get("/excel", function(req,res){

res.render("excel")

})

![](./img/195_img_11.png)

<!DOCTYPE html>

<html lang="en">

<head>

<meta charset="UTF-8">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Document</title>

</head>

<body>

</body>

</html>

이런식으로 완성해줍니다.

브라우저에서 확인해봅시다

![](./img/195_img_12.png)

뜨는거확인했으니까 이번엔 body를 수정해봅시다

<p>

엑셀 업로드 :<input type="file" id="excelFile" onchange="excelExport(event)"/>

</p>

이제 브라우저에서 확인해봅시다.

![](./img/195_img_13.png)

이제 엑셀파일을 올리고 엑셀파일을 JSON으로 바꿔주는 도구를 사용할껍니다.

<https://github.com/SheetJS/sheetjs>

[ GitHub - SheetJS/sheetjs: ? SheetJS Spreadsheet Data Toolkit -- New home https://git.sheetjs.com/SheetJS/sheetjs ? SheetJS Spreadsheet Data Toolkit -- New home https://git.sheetjs.com/SheetJS/sheetjs - SheetJS/sheetjs github.com ](https://github.com/SheetJS/sheetjs)

<https://docs.sheetjs.com/docs/>

[ Overview | SheetJS Community Edition SheetJS Community Edition offers battle-tested open-source solutions for docs.sheetjs.com ](https://docs.sheetjs.com/docs/)

불러오는건 

<https://cdnjs.com/libraries/xlsx>

[ xlsx - Libraries - cdnjs - The #1 free and open source CDN built to make life easier for developers Excel (XLSB/XLSX/XLSM/XLS/XML) and ODS spreadsheet parser and writer - Simple. Fast. Reliable. Content delivery at its finest. cdnjs is a free and open-source CDN service trusted by over 12.5% of all websites, serving over 200 billion requests each month, cdnjs.com ](https://cdnjs.com/libraries/xlsx)

이사이트에서 가져오면 됩니다.

이제 파일에 복붙

<script src="<https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js>"></script>

excelExport

이 함수만 구현하면 될꺼같습니다.

<script>

function excelExport(event){

var input = event.target;

var reader = new FileReader();

reader.onload = function(){

var fileData = reader.result;

var wb = XLSX.read(fileData, {type : 'binary'});

wb.SheetNames.forEach(function(sheetName){

var rowObj =XLSX.utils.sheet_to_json(wb.Sheets[sheetName]);

console.log(JSON.stringify(rowObj));

})

};

reader.readAsBinaryString(input.files[0]);

}

</script>

  * 사용자가 업로드한 Excel 파일을 FileReader로 읽고,
  * xlsx 라이브러리를 이용해 해당 파일을 파싱하고,
  * 각 시트를 JSON 형태로 변환한 후,
  * 그 결과를 console.log()로 출력합니다.



function excelExport(event){

var input = event.target;

event.target은 <input type="file"> 요소 자체를 가리킵니다.

var reader = new FileReader();

브라우저에서 파일 내용을 읽기 위한 객체입니다

reader.onload = function(){

var fileData = reader.result;

파일이 성공적으로 읽혔을 때 실행될 콜백 함수입니다. 결과는 reader.result에 저장됨.

var wb = XLSX.read(fileData, {type : 'binary'});

XLSX.read()는 xlsx 파일을 파싱합니다.

{type: 'binary'}는 이진 데이터로 읽는다는 설정입니다.

wb는 "workbook" 객체입니다.

wb.SheetNames.forEach(function(sheetName){

var rowObj =XLSX.utils.sheet_to_json(wb.Sheets[sheetName]);

console.log(JSON.stringify(rowObj));

})

};

SheetNames는 모든 시트 이름을 배열로 반환합니다.

각 시트를 JSON으로 변환한 후 console.log()로 출력합니다.

sheet_to_json()은 시트를 행 단위 JSON 배열로 변환합니다.

예: [{A: '값1', B: '값2'}, ...]

reader.readAsBinaryString(input.files[0]);

파일 input에서 선택한 첫 번째 파일을 이진 문자열로 읽기 시작합니다.

이 과정이 끝나면 위의 onload 함수가 호출됩니다.

브라우저에서 파일업로드 후 확인해봅시다.

![](./img/195_img_14.png)

**엑셀파일 읽어서 원하는 결과값만 추려 엑셀파일 만들기**

* * *

console.table(rowObj);

이렇게 바꿔서 확인해보면 테이블 형태로도 볼수있습니다.

![](./img/195_img_15.png)

mySQL 과 비슷하네요

주소에들어가면 정해진 로직에따라 엑셀파일이 다운되는 코드를 짜봅시다.

그러기위해서 도구가 필요합니다.

<https://www.npmjs.com/package/json2xls>

[ json2xls canonically transform json to an excel document. Latest version: 0.1.2, last published: 9 years ago. Start using json2xls in your project by running `npm i json2xls`. There are 90 other projects in the npm registry using json2xls. www.npmjs.com ](https://www.npmjs.com/package/json2xls)

도구를 일단 다운 받아봅시다.

![](./img/195_img_16.png)

app.js에 무조건 넣어야합니다.

const json2xls = require('json2xls');

사용도해야하니까

app.use(json2xls.middleware);

이제 다 했으니까 라우터 추가해줍시다.

router.get("/excel/down", function(req,res){

let excel_data = [{"A":1,"B":2,"C":3,"D":4}]

res.xls('data.xlsx', excel_data);

})

브라우저에서 GET /excel/down 요청을 보내면,  
서버는 JSON 데이터를 기반으로 Excel 파일(data.xlsx)을 생성하여 다운로드 응답을 보내는 코드입니다.

이제 브라우저에서 확인해보죠

![](./img/195_img_17.png) ![](./img/195_img_18.png)

**Node.js로 손쉽게 만들 수 있는 유용한 기능들**

* * *

**1\. node-schedule**

<https://www.npmjs.com/package/node-schedule>

[ node-schedule A cron-like and not-cron-like job scheduler for Node.. Latest version: 2.1.1, last published: 2 years ago. Start using node-schedule in your project by running `npm i node-schedule`. There are 1976 other projects in the npm registry using node-schedule. www.npmjs.com ](https://www.npmjs.com/package/node-schedule)

Node.js에서 작업 스케줄링(예약 실행)을 할 수 있게 해주는 라이브러리입니다.  
예를 들어, 특정 시간마 다 함수 실행, 매일 자정에 백업 수행 같은 기능을 간단하게 구현할 수 있습니다.

![](./img/195_img_19.png)

**2\. Nodemailer**

<https://www.npmjs.com/package/nodemailer>

[ https://www.npmjs.com/package/nodemailer [!TIP] Check out EmailEngine – a self-hosted email gateway that allows making REST requests against IMAP and SMTP servers. EmailEngine also sends webhooks whenever something changes on the registered accounts. Using the email accounts registered with Ema www.npmjs.com ](https://www.npmjs.com/package/nodemailer)

말 그대로 메일을 보내줍니다 또한 gmail과 궁합이 잘 맞습니다.

![](./img/195_img_20.png)

정보를 기입하면 이메일을 발송하는 도구입니다.

**3. html2pdf.js **

<https://www.npmjs.com/package/html2pdf.js/v/0.9.0>

[ html2pdf.js Client-side HTML-to-PDF rendering using pure JS. Latest version: 0.10.3, last published: 4 months ago. Start using html2pdf.js in your project by running `npm i html2pdf.js`. There are 176 other projects in the npm registry using html2pdf.js. www.npmjs.com ](https://www.npmjs.com/package/html2pdf.js/v/0.9.0)

html 파일을 pdf로 변환해주고 다운도 받을수 있게 합니다.

**4. html2canvas **

<https://www.npmjs.com/package/html2canvas/v/1.4.1>

[ html2canvas Screenshots with JavaScript. Latest version: 1.4.1, last published: 3 years ago. Start using html2canvas in your project by running `npm i html2canvas`. There are 3014 other projects in the npm registry using html2canvas. www.npmjs.com ](https://www.npmjs.com/package/html2canvas/v/1.4.1)

이번엔 html을 이미지 파일로 바꿔 줍니다.

그리고 또한 html canvas는 html 에서 제공하는 태그입니다. 

<https://www.w3schools.com/html/html5_canvas.asp>

[ W3Schools.com W3Schools offers free online tutorials, references and exercises in all the major languages of the web. Covering popular subjects like HTML, CSS, JavaScript, Python, SQL, Java, and many, many more. www.w3schools.com ](https://www.w3schools.com/html/html5_canvas.asp)

html화면에서 그림을 그릴수있습니다.그래서 html 화면을 이미지화 시켜서 보정을 해서 디자인도 가능합니다.

**5\. Cropper.js**

<https://www.npmjs.com/package/cropperjs>

[ cropperjs JavaScript image cropper.. Latest version: 2.0.0, last published: 4 months ago. Start using cropperjs in your project by running `npm i cropperjs`. There are 911 other projects in the npm registry using cropperjs. www.npmjs.com ](https://www.npmjs.com/package/cropperjs)

이미지를 자르는 도구입니다. 사용자는 이미지의 원하는 영역을 마우스로 직접 선택하고, 이를 크롭하여 파일로 저장하거나 서버로 전송할 수 있습니다.

<https://fengyuanchen.github.io/cropperjs/playground.html>

[ Playground | Cropper.js fengyuanchen.github.io ](https://fengyuanchen.github.io/cropperjs/playground.html)

![](./img/195_img_21.png)


## 🔗 제텔카스텐 연결

### 관련 개념
- [[]]
- [[]]

### 프로젝트 연결
- [[]]

### 학습 포인트
-

## 📋 액션 아이템
- [ ]
- [ ]

## 💡 개인적 통찰



---

**태그**: #project웹개발
**상태**: 🌱 씨앗 (제텔카스텐 통합 대기)
**변환일**: 2025-10-07
