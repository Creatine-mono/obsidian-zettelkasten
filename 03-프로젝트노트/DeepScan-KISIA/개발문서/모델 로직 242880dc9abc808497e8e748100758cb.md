# 모델 로직

```json
import concurrent.futures

def detect_llm_guard(text):
    # 빠른 정규식+룰 기반 탐지
    return llm_guard_scan(text)

def detect_pii_redact(text):
    # 무거운 LLM 기반 정밀 탐지
    return pii_redact_scan(text)

def hybrid_parallel_scan(text):
    with concurrent.futures.ThreadPoolExecutor() as executor:
        future_llm = executor.submit(detect_llm_guard, text)
        future_pii = executor.submit(detect_pii_redact, text)

        # LLM-Guard 결과는 최대 5초 내로 받음(빠른 알림용)
        try:
            llm_result = future_llm.result(timeout=5)
            if llm_result.detected:
                print("LLM-Guard: PII 탐지됨, 즉시 알림!")
                # PII-Redact 결과가 아직 안 끝났어도 알림 가능
                # 필요하면 결과 기다리기 가능
                detailed = future_pii.result()
                return detailed
            else:
                # LLM-Guard가 못찾으면 PII-Redact 결과 기다림
                detailed = future_pii.result()
                return detailed
        except concurrent.futures.TimeoutError:
            print("LLM-Guard 시간이 초과됨, PII-Redact 결과 기다림")
            detailed = future_pii.result()
            return detailed
```

- 이렇게하면 탐지에 대해서는 수초 내 가능하지만 정상 프롬프트인 경우에는 여전히 pii가 끝날때 까지 기다려야해서 오래걸림

- pii 파인 튜닝
- korean ppi 파인튜닝 bert
    - [https://huggingface.co/alphagyuu/Korean-PII-Masking-BertForTokenClassification](https://huggingface.co/alphagyuu/Korean-PII-Masking-BertForTokenClassification)